---

# Tareas de reinicio y espera de puertos en los diferentes nodos del entorno

# Reiniciar el servicio de Filebeat
- name: restart filebeat
  become: yes
  service: 
    name: filebeat.service
    state: stopped
    enabled: yes
  listen: "restartfilebeat"

# Reiniciar el servicio de WSO2
- name: restart_wso2
  become: yes
  service: 
    name: wso2.service
    state: stopped
    enabled: yes
  listen: "restart"

# Esperar a que el puerto 9711 esté disponible en los nodos de Traffic Manager
- name: esperar_TM 9711
  wait_for:
    port: 9711
    timeout: 180
  when: '"tm" in ansible_hostname'
  listen: "restart"

# Esperar a que el puerto 9443 esté disponible en los nodos de Control Plane
- name: esperar_CP 9443
  wait_for:
    port: 9443
    timeout: 180
  when: '"cp" in ansible_hostname'
  listen: "restart"